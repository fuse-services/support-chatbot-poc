<!DOCTYPE html>
<html>

<head>
    <title>Chatbot Example</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css'>    
</head>

<body>
    <div class="supportticket-container">
        <div class="question-container">
            <div class="title-bar">
                <img class="logo" src="./static/qdabra-icon.webp" />
                <label class="title"><h1>Support Ticket</h1></label>
            </div>
            <div class="divider"><h2>Customer Contact</h2></div>
            <div class="customer-detail">
                <div class="customer-question">
                    <label class="question">Company Name  <span style="color:red;font-weight: bolder;">*</span></label>
                    <input type="text" placeholder="" id="txt-company-name" value="qdabra">
                </div>

                <div class="customer-question">
                    <label class="question">Full Name  <span style="color:red;font-weight: bolder;">*</span></label>
                    <input type="text" placeholder="" id="txt-name" value="ujjwal"></textarea>
                </div>

                <div class="customer-question">
                    <label class="question">Email  <span style="color:red;font-weight: bolder;">*</span></label>
                    <input type="text" placeholder="" id="txt-email" value="ujjwal.maharjan@fusemachines.com">
                </div>
            </div>
            <div class="QASection">
                <div class="divider"><h2>Issue Detail</h2></div>
                <form id="issue-detail" class="issue-detail">
                    <div id="question-div0" class="question">1. What is the issue/problem?  <span style="color:red;font-weight: bolder;">*</span></div> 
                    <div class="answer">
                        <input type="text" placeholder="" id="answer-txt0">
                    </div>

                    <div id="question-div1" class="question">2. What are the steps that you encountered the issue?  <span style="color:red;font-weight: bolder;">*</span></div>
                    <div class="answer">
                        <textarea placeholder="" id="answer-txt1"></textarea>
                    </div>

                    <div id="question-div2" class="question">3. What is the actual result that you got?  <span style="color:red;font-weight: bolder;">*</span></div>
                    <div class="answer">
                        <input type="text" placeholder="" id="answer-txt2">
                    </div>

                    <div id="question-div3" class="question">4. What is your expected result?  <span style="color:red;font-weight: bolder;">*</span></div>
                    <div class="answer">
                        <input type="text" placeholder="" id="answer-txt3">
                    </div>
                    <!-- id="question-div4" -->
                    <div class="question">5. Attach Screenshots</div>
                    <div id="drop-area">
                        <input type="file" id="screenshot-input" multiple>
                        <span class="drop-message" id="screenshot-name">Drag and Drop or click to upload the screenshot images.</span>
                    </div>
                    <!-- id="question-div5" -->
                    <div class="question">6. Attach xsn file</div> 
                        <div id="drop-area-xsn">
                        <input type="file" id="xsn-file-input">
                        <span class="drop-message" id="xsn-file-name">Drag and Drop or click to upload the xsn file.</span>
                    </div>
                    <div class="submit-container">
                        <button id="submit-issue" class="submit-button" type="submit">Search Solution</button>
                    </div>
                    <div class="debug-button">
                        <!-- <input type="button" class="debug-button" value="Debug">  -->
                        <span>...</span>
                    </div>
                </form>
            </div>
        

            <!-- <div class="solution-section" style="display: none;">
                <div class="divider"><h2>Solutions</h2></div>
                <div class="searched-solution">
                    <div id="similar-count" class="question">Found</div>
                    <div class="similar-issues"></div>
                    <div class="submit-container">
                        <input id="btn-generate-solution" class="submit-button" type="button" value="Generate Solution">
                    </div>
                </div>
            </div>

            
            <div class="generated-solution-section" style="display: none;">
                <div class="divider"><h2>Generated Solutions</h2></div>
                <div class="generated-solution"></div>
            </div>
        </div> -->
        
            <div id="chatbot-assistant">
                <div id="chatbox">
                    <div id="chatlog"></div>
                    <form id="message-form">
                        <div style="display: flex; align-items: center; padding: 10px 0;">
                            <div id="user-icon"><strong>User:</strong></div>
                            <input type="text" id="message-input" placeholder="Type your message..." required />
                            <button type="submit" style="align-items:center;padding:10px;border-radius:5px;border:1px solid #ccc;">Send</button>
                        </div>
                    </form>
                </div>
                <div id="chatbot-icon">
                    <img src="./static/chatbot-icon.png" style="height:75px;width:75px"></img>
                </div>
            </div>
        </div>
    </div>

    <div class="debug-container">
       <div class="debug-section">
            Debug Area
            <div class="debug-div">
                <div class="debug-url-div"><span class="header-span">URL</span></div>
                <div class="debug-body-div"><span class="header-span">Body</span></div>
                <div class="debug-response-div"><span class="header-span">Response</span></div>
                <div class="debug-expand-div"></div>
            </div>
        </div>
    </div>

    <div class="loader-overlay" id="loader-div" style="display: none;">
        <div class="loader"></div>
    </div>
    
    <script language="javascript" src="./scripts/request-api.js" > </script>
    <script language="javascript" src="./scripts/render-message.js" > </script>
    <script language="javascript" src="./scripts/scripting.js" > </script>
    <script language="javascript" src="./scripts/handle-files.js" > </script>
    <script>

        const chatbot = document.getElementById("chatbot-icon");
        const chatbotDiv = document.getElementById("chatbox");
        
        chatbot.addEventListener('click', toggleChatbot);
        chatbotDiv.style.display == "block" ? document.body.style.alignItems = "": document.body.style.alignItems = "center";

        
        const messageInput = document.getElementById("message-input");
        messageInput.addEventListener('keydown', highLightTextbox);
        messageInput.addEventListener('focus', highLightTextbox);

        function toggleChatbot() {
            const supportTicketContainer = document.querySelector(".supportticket-container");
            if (chatbotDiv.style.display == "block") {
                chatbotDiv.style.display = "none";
                document.body.style.alignItems = "center";
                supportTicketContainer.style.margin = "1%";
            } else {
                chatbotDiv.style.display = "block";
                document.body.style.alignItems ="";
                supportTicketContainer.style.margin = "1% 5%";

            }
        }

        makeOpenAICall([{ "role": "system", "content": `You are a Qdabra Support Assistant, ${questions[0].prompt}` }]);
        // makeOpenAICall(questionContext);

        function showLoader(show) {
            const loader = document.getElementById("loader-div");
            loader.style.display = show == true ? "block" : "none";
        }

        document.querySelector('.debug-button').addEventListener('click', toggleDebugSection);
        function toggleDebugSection() {
            const debugSection = document.querySelector(".debug-section");
            // const tab = document.querySelector(".tab");

            if (debugSection.style.display=== "none") {
                debugSection.style.display = "block";
            } else {
                debugSection.style.display = "none";
            }
        }
    </script>
</body>

</html>
